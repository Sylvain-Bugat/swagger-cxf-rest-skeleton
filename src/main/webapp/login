<!DOCTYPE html>
<html>
	<head>
		<title tiles:fragment="title">Login</title>
		<script src='jquery-2.1.4.min.js' type='text/javascript'></script>

		<script type="text/javascript">
			$(document).ready(function() {
				$('form[name=loginForm]').submit(function(e){
					e.preventDefault();
					$.ajax({
						type: 'POST',
						cache: false,
						url: '/api/user/login',
						data: $(this).serialize(),
						success: function(msg) {
							window.location.replace("/login?apiToken=" + msg.apiToken);
						}
					});
				});

				var apiKey = location.search.split('apiToken=')[1];
				if (typeof apiKey != 'undefined') {
					var apiTokenField=document.getElementById('apiToken');
					apiTokenField.value=apiKey;
					submitAPITokenForm();
				}
			});

			function submitAPITokenForm()
			{
				var xhr = new XMLHttpRequest();
				xhr.onload = function(){
					document.write(xhr.responseText);
					document.close();
				}
				var apiTokenField=document.getElementById('apiToken');
				xhr.open ("GET", "/api/swagger.html", true);
				xhr.setRequestHeader('api_token', apiTokenField.value);
				xhr.send();
				return false;
			}
		</script>
	</head>
	<body>
		<div id="boxContentId">
		</div>
		<div tiles:fragment="content">
			<form name="loginForm" action="/api/user/login" method="POST>
				<fieldset>
					<legend>Please Login</legend>
					<div th:if="${param.error}" class="alert alert-error">
						Invalid username and password.
					</div>
					<label for="username">Username</label>
					<input type="text" id="username" name="username"/>
					<label for="password">Password</label>
					<input type="password" id="password" name="password"/>
					<div class="form-actions">
						<button type="submit" class="btn">Log in</button>
					</div>
				</fieldset>
			</form>

			<form style="display: none;" name="apiTokenForm" action="/api/swagger.html" method="GET">
				<fieldset>
					<legend>Use/test an existing API token</legend>
					<label for="apiToken">API token</label>
					<input type="text" id="apiToken" name="apiToken"/>
					<div class="form-actions">
						<button type="submit" class="btn">Log in</button>
					</div>
				</fieldset>
			</form>
		</div>
	</body>
</html>
